<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Qu·∫£n l√Ω CƒÉn h·ªô</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <img src="logo.jpg" alt="Logo" class="logo" />
            <div class="header-text">
                <h1>Qu·∫£n l√Ω CƒÉn h·ªô</h1>
                <p>Website qu·∫£n l√Ω c∆∞ d√¢n v√† thi·∫øt b·ªã</p>
            </div>
        </div>
    </header>
    <!-- Navbar -->
    <nav class="navbar">
        <button class="navbtn" id="loginBtn" onclick="showPage('loginPage')">ƒêƒÉng nh·∫≠p</button>
        <button class="navbtn" onclick="showPage('homePage')">Trang ch·ªß</button>
        <button class="navbtn" onclick="showPage('cameraPage')">Camera</button>
        <button class="navbtn" onclick="showPage('wifiPage')">K·∫øt n·ªëi WiFi</button>
        <button class="navbtn" onclick="showPage('residentPage')">Gi√°m s√°t</button>
        <div style="flex-grow: 1;"></div> <!-- ƒë·∫©y logoutBtn sang ph·∫£i -->
        <button class="navbtn" id="logoutBtn" style="display: none;" onclick="logout()">ƒêƒÉng xu·∫•t</button>
    </nav>

    <!-- Trang ch·ªß -->
    <div id="homePage" class="page">
        <div class="content-column">
            <!-- Kh·ªëi tr√™n r·ªông full, ch·ªâ 1 box ƒë∆°n -->
            <div class="profile-box single-box">
                <div class="info">
                    <h3>ƒê·ªÄ T√ÄI : H·ªÜ TH·ªêNG AN NINH V√Ä C·∫¢NH B√ÅO CH√ÅY N·ªî CHO CHUNG C∆Ø V·ª™A V√Ä NH·ªé S·ª¨ D·ª§NG M·∫†NG WIFI MESH
                    </h3>
                    <p>GVHD: Tr∆∞∆°ng Quang Ph√∫c</p>
                </div>
            </div>

            <!-- 2 kh·ªëi d∆∞·ªõi chia ƒë√¥i -->
            <div class="content-row">
                <div class="profile-box">
                    <img src="huy.jpg" alt="L√™ Huy" class="avatar" />
                    <div class="info">
                        <h3>L√™ Huy</h3>
                        <p>MSSV : 20161203</p>
                        <p>Email : 20161203@student.hcmute.edu.vn</p>
                        <p>SƒêT : 0856554779</p>
                    </div>
                </div>

                <div class="profile-box">
                    <img src="khoi.jpg" alt="Nguy·ªÖn Lan" class="avatar" />
                    <div class="info">
                        <h3>Nguy·ªÖn L√™ Minh Kh√¥i</h3>
                        <p>MSSV : 20161204</p>
                        <p>Email : 20161204@student.hcmute.edu.vn</p>
                        <p>SƒêT : 0987654321</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera -->
    <div id="cameraPage" class="page">
        <h2>Camera</h2>
        <img src="http://172.20.10.13:5000/video" width="640" height="480" alt="Camera Stream" />
    </div>

    <!-- K·∫øt n·ªëi WiFi -->
    <div id="wifiPage" class="page">
        <div class="container">
            <h2>Connecting Bluetooth Wi-Fi Setup</h2>
            <button id="scanButton">Scan for ESP32</button>
            <p id="status"></p>
            <form id="wifiForm" style="display:none;">
                <label for="ssid">Wi-Fi SSID:</label>
                <input type="text" id="ssid" required /><br />
                <label for="password">Wi-Fi Password:</label>
                <input type="password" id="password" required /><br />
                <button type="submit">Connect to Wi-Fi</button>
            </form>
        </div>

        <div class="container2">
            <h2>H∆∞·ªõng d·∫´n k·∫øt n·ªëi Wifi cho thi·∫øt b·ªã</h2>
            <p>1. C·∫•p ngu·ªìn cho MODULE </p>
            <p>2. Ch·ªçn "Scan for ESP32"</p>
            <p>3. Ch·ªçn thi·∫øt b·ªã c·∫ßn k·∫øt n·ªëi v·ªõi t√™n thi·∫øt b·ªã ƒë∆∞·ª£c in tr√™n thi·∫øt b·ªã VD: MODULE #### </p>
            <p>4. Nh·∫≠p Wi-Fi SSID v√† m·∫≠t kh·∫©u</p>
            <p>5. Click "Connect to Wi-Fi"</p>
            <p>6. ƒê·ª£i thi·∫øt b·ªã k·∫øt n·ªëi Wi-Fi</p>
            <p>7. N·∫øu thi·∫øt b·ªã k√™u 2 ti·∫øng bip l√† k·∫øt n·ªëi th√†nh c√¥ng</p>
            <p>8. N·∫øu thi·∫øt b·ªã k√™u 1 ti·∫øng bip l√† k·∫øt n·ªëi th·∫•t b·∫°i ki·ªÉm tra l·∫°i SSID v√† m·∫≠t kh·∫©u</p>
        </div>
    </div>

    <!-- D·ªØ li·ªáu c∆∞ d√¢n -->
    <div id="residentPage" class="page">
        <table>
            <tr>
                <th>L·∫ßu</th>
                <th>Kh√≥i</th>
                <th>Gas</th>
                <th>Ph√≤ng</th>
                <th colspan="4">Kh√≥i</th>
                <th colspan="4">Gas</th>
                <th>Nhi·ªát ƒë·ªô</th>
                <th>ƒê·ªô ·∫©m</th>
            </tr>
            <tr>
                <th rowspan="3">1</th>
                <td>-</td>
                <td>-</td>
                <td>101</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>-</td>
                <td>-</td>
                <td>102</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>

                <td>-</td>
                <td>-</td>
                <td>103</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
        </table>
        <table>
            <tr>
                <th>L·∫ßu</th>
                <th>Kh√≥i</th>
                <th>Gas</th>
                <th>Ph√≤ng</th>
                <th colspan="4">Kh√≥i</th>
                <th colspan="4">Gas</th>
                <th>Nhi·ªát ƒë·ªô</th>
                <th>ƒê·ªô ·∫©m</th>
            </tr>
            <tr>
                <th rowspan="3">2</th>
                <td>-</td>
                <td>-</td>
                <td>201</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>-</td>
                <td>-</td>
                <td>202</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>

                <td>-</td>
                <td>-</td>
                <td>203</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
        </table>
        <table>
            <tr>
                <th>L·∫ßu</th>
                <th>Kh√≥i</th>
                <th>Gas</th>
                <th>Ph√≤ng</th>
                <th colspan="4">Kh√≥i</th>
                <th colspan="4">Gas</th>
                <th>Nhi·ªát ƒë·ªô</th>
                <th>ƒê·ªô ·∫©m</th>
            </tr>
            <tr>
                <th rowspan="3">3</th>
                <td>-</td>
                <td>-</td>
                <td>301</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>-</td>
                <td>-</td>
                <td>302</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>

                <td>-</td>
                <td>-</td>
                <td>303</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
        </table>
    </div>
    <div id="loginPage" class="page active">
        <div class="container2">
            <h2>ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h2>
            <form id="loginForm">
                <label for="loginEmail">Email:</label><br />
                <input type="email" id="loginEmail" name="email" required /><br />
                <label for="loginPassword">M·∫≠t kh·∫©u:</label><br />
                <input type="password" id="loginPassword" name="password" required /><br />
                <button type="submit">ƒêƒÉng nh·∫≠p</button>
            </form>
            <p id="loginStatus" style="color: red; margin-top: 10px;"></p>
        </div>
    </div>


    <!-- Footer -->
    <footer>
        <p>TR∆Ø·ªúNG ƒê·∫†I H·ªåC S∆Ø PH·∫†M K·ª∏ THU·∫¨T TP. HCM - HCMUTE</p>
    </footer>

    <script src="script.js"></script>
    <div id="alertContainer"></div>


</body>
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCaUmIE3hWU0mLLLw3wtU7BNkoxnmL3m6U",
        authDomain: "chung-cu-an-ninh.firebaseapp.com",
        databaseURL: "https://chung-cu-an-ninh-default-rtdb.firebaseio.com",
        projectId: "chung-cu-an-ninh",
        storageBucket: "chung-cu-an-ninh.firebasestorage.app",
        messagingSenderId: "413202920707",
        appId: "1:413202920707:web:c28e96396a314ef3c1e536",
        measurementId: "G-28V9P24V2R"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
</script>
<script type="module">
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

    const db = getDatabase();


    function updateRoomData() {
        const table = document.querySelector("#residentPage table");
        const hanhlangRef = ref(db, "can_ho/lau1/hanh_lang");
        const phongRef = ref(db, "can_ho/lau1");

        // C·∫≠p nh·∫≠t d·ªØ li·ªáu h√†nh lang t·∫ßng 1
        onValue(hanhlangRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                table.rows[1].cells[1].innerText = data.khoi1;
                table.rows[2].cells[0].innerText = data.khoi2;
                table.rows[3].cells[0].innerText = data.khoi3;

                table.rows[1].cells[2].innerText = data.gas1;
                table.rows[2].cells[1].innerText = data.gas2;
                table.rows[3].cells[1].innerText = data.gas3;
                if (data.khoi1 > 10) showAlert("‚ö†Ô∏è C·∫£nh b√°o KH√ìI cao t·∫°i h√†nh lang l·∫ßu 1!");
                if (data.gas1 > 50) showAlert("‚ö†Ô∏è C·∫£nh b√°o GAS cao t·∫°i h√†nh lang l·∫ßu 1!");
                if (data.khoi2 > 10) showAlert("‚ö†Ô∏è C·∫£nh b√°o KH√ìI cao t·∫°i h√†nh lang l·∫ßu 1!");
                if (data.gas2 > 50) showAlert("‚ö†Ô∏è C·∫£nh b√°o GAS cao t·∫°i h√†nh lang l·∫ßu 1!");
                if (data.khoi3 > 10) showAlert("‚ö†Ô∏è C·∫£nh b√°o KH√ìI cao t·∫°i h√†nh lang l·∫ßu 1!");
                if (data.gas3 > 50) showAlert("‚ö†Ô∏è C·∫£nh b√°o GAS cao t·∫°i h√†nh lang l·∫ßu 1!");
                if (data.sos > 0) showAlert("üî• B√°o Ch√°y Kh·∫©n ·∫•p");

            }
        });

        // C·∫≠p nh·∫≠t d·ªØ li·ªáu c√°c ph√≤ng t·∫ßng 1
        onValue(phongRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                let roomIndex = 0;
                for (let key in data) {
                    if (key.startsWith("phong")) { // ch·ªâ l·∫•y c√°c node t√™n phongxxx
                        const room = data[key];
                        const row = table.rows[1 + roomIndex];
                        row.cells[4].innerText = room.khoi1 ?? "-";
                        row.cells[5].innerText = room.khoi2 ?? "-";
                        row.cells[6].innerText = room.khoi3 ?? "-";
                        row.cells[7].innerText = room.khoi4 ?? "-";
                        row.cells[8].innerText = room.gas1 ?? "-";
                        row.cells[9].innerText = room.gas2 ?? "-";
                        row.cells[10].innerText = room.gas3 ?? "-";
                        row.cells[11].innerText = room.gas4 ?? "-";
                        row.cells[12].innerText = room.temperature ?? "-";
                        row.cells[13].innerText = room.humidity ?? "-";
                        if (room.khoi1 > 10) showAlert(`‚ö†Ô∏è Kh√≥i cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.gas1 > 50) showAlert(`‚ö†Ô∏è Gas cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.khoi2 > 10) showAlert(`‚ö†Ô∏è Kh√≥i cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.gas2 > 50) showAlert(`‚ö†Ô∏è Gas cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.khoi3 > 10) showAlert(`‚ö†Ô∏è Kh√≥i cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.gas3 > 50) showAlert(`‚ö†Ô∏è Gas cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.khoi4 > 10) showAlert(`‚ö†Ô∏è Kh√≥i cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.gas4 > 50) showAlert(`‚ö†Ô∏è Gas cao t·∫°i ph√≤ng ${key.toUpperCase()}`);
                        if (room.sos > 0) showAlert(`Ph√≤ng 101 c·∫ßn gi√∫p ${key.toUpperCase()}`);
                        roomIndex++;
                    }
                }
            }
        });
    }

    // G·ªçi khi chuy·ªÉn sang tab gi√°m s√°t
    window.showPage = function (id) {
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        if (id === "residentPage") updateRoomData();
    };
</script>

</html>